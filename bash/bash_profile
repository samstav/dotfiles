#!/usr/bin/env bash

export PATH=~/local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/lib:/usr/bin:/bin:/usr/sbin:/sbin:/opt/X11/bin:~/.pyenv/bin:~/.local/bin:$PATH

# https://github.com/samstav/dotfiles
export DOTFILES_DIR=${DOTFILES_DIR:-~/dotfiles}

if ! git -C ${DOTFILES_DIR} diff-index --quiet HEAD --; then
  # remind me that I have dotfiles changes
  echo '...............'
fi

errcho() {
  printf "%s\n" "$@" 1>&2
}

errxit ()
{
  errcho "$@"
  exit 1
}


# shellcheck disable=SC2120
_err() {
  if [ -n "${1:-}" ]; then
    _errmsg="‚è© Error at line ${1} of ${BASH_SOURCE:-${0}}"
    if [ -n "${2:-}" ]; then
      _errmsg="${_errmsg} in function '${2}'"
    fi
    errcho "${_errmsg}"
  fi
  errcho "‚õîÔ∏è Script failed."
}

_sigint() {
  errcho "üçø Script discontinued."
  exit 1
}

trap '_err ${LINENO} ${FUNCNAME:-}' ERR
trap '_sigint' SIGHUP SIGINT SIGTERM

if [ ! -d "${DOTFILES_DIR}" ]; then
  errcho 'dotfiles directory not found'
else
  source "${DOTFILES_DIR}/bash/shell.sh"
  source "${DOTFILES_DIR}/lang/python/python.sh"
  source "${DOTFILES_DIR}/lang/node/node.sh"
  source "${DOTFILES_DIR}/lang/go/go.sh"
  source "${DOTFILES_DIR}/bash/aliases.sh"
  if [[ -f "${DOTFILES_DIR}/bash/history.sh" ]]; then
    source "${DOTFILES_DIR}/bash/history.sh"
  fi
  if [[ $OSTYPE == *"darwin"* ]]; then
    source "${DOTFILES_DIR}/osx/osx.sh"
  fi
  # autocomplete scm, tmux
  for f in "${DOTFILES_DIR}"/autocomplete/*.bash; do
    # run ./bash/fetch_autocompleters.sh to fetch these
    source $f;
  done
fi

# vim please
export VISUAL=vim
export GIT_EDITOR=vim
